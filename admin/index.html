<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ - Бонусная система ПЕРЕЦ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #c0c0c0;
            color: #000;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .screen {
            display: none;
            flex: 1;
            flex-direction: column;
            padding: 10px;
            background: #c0c0c0;
        }
        
        .active {
            display: flex !important;
        }
        
        .header {
            background: #000080;
            color: #fff;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            border: 2px solid #000;
        }
        
        .login-form {
            background: #c0c0c0;
            padding: 20px;
            border: 2px solid #000;
            margin: 50px auto;
            width: 300px;
        }
        
        .login-input {
            width: 100%;
            padding: 10px;
            font-size: 18px;
            margin: 10px 0;
            border: 2px solid #000;
            background: #fff;
        }
        
        .login-button {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: #c0c0c0;
            border: 2px solid #000;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .login-button:active {
            background: #a0a0a0;
        }
        
        .status-bar {
            background: #000080;
            color: #fff;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #000;
            margin-bottom: 10px;
        }
        
        .main-button {
            background: #c0c0c0;
            color: #000;
            border: 2px solid #000;
            padding: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px 0;
            text-align: left;
        }
        
        .main-button:active {
            background: #a0a0a0;
        }
        
        .input-field {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #000;
            background: #fff;
            margin: 10px 0;
        }
        
        .button-row {
            display: flex;
            gap: 5px;
            margin: 5px 0;
        }
        
        .number-button {
            flex: 1;
            background: #c0c0c0;
            color: #000;
            border: 2px solid #000;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .number-button:active {
            background: #a0a0a0;
        }
        
        .action-button {
            background: #c0c0c0;
            color: #000;
            border: 2px solid #000;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px 0;
            width: 100%;
        }
        
        .green-button {
            background: #00ff00;
        }
        
        .red-button {
            background: #ff0000;
            color: #fff;
        }
        
        .user-info {
            background: #c0c0c0;
            padding: 15px;
            border: 2px solid #000;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .balance-display {
            font-size: 18px;
            color: #000;
            font-weight: bold;
            margin: 10px 0;
            background: #fff;
            padding: 10px;
            border: 1px solid #000;
        }
        
        .calculator-display {
            background: #c0c0c0;
            padding: 15px;
            border: 2px solid #000;
            margin: 10px 0;
        }
        
        .bonus-result {
            font-size: 16px;
            color: #000;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            background: #fff;
            padding: 10px;
            border: 1px solid #000;
        }
        
        .info-text {
            font-size: 12px;
            color: #000;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <!-- ЭКРАН ВХОДА -->
    <div class="screen active" id="loginScreen">
        <div class="header">БОНУСНАЯ СИСТЕМА "ПЕРЕЦ"</div>
        
        <div class="login-form">
            <div class="info-text">Кассир: Елена</div>
            <div class="info-text">Введите четырехзначный код:</div>
            <input type="password" class="login-input" id="loginCode" maxlength="4" placeholder="5901">
            <button class="login-button" onclick="checkLogin()">ВХОД</button>
            <div class="info-text" id="loginError" style="color:red; display:none;">Неверный код!</div>
        </div>
    </div>

    <!-- ГЛАВНЫЙ ЭКРАН -->
    <div class="screen" id="mainScreen">
        <div class="status-bar">Кассир: Елена | Бонусная система "ПЕРЕЦ"</div>
        
        <button class="main-button" onclick="startBarcodeScan()">
            [F2] СКАНИРОВАТЬ ШТРИХКОД
        </button>
        
        <button class="main-button" onclick="showManualInput()">
            [F3] РУЧНОЙ ВВОД ШТРИХКОДА
        </button>
        
        <button class="main-button red-button" onclick="logout()">
            [ESC] ВЫХОД
        </button>
    </div>

    <!-- ЭКРАН РУЧНОГО ВВОДА ШТРИХКОДА -->
    <div class="screen" id="manualInputScreen">
        <div class="status-bar">Кассир: Елена | Ручной ввод штрихкода</div>
        
        <input type="text" class="input-field" id="barcodeInput" placeholder="Введите 12 цифр штрихкода" maxlength="12" onkeypress="return handleBarcodeInput(event)">
        <div class="info-text">Нажмите Enter для поиска или введите 12 цифр</div>
        
        <div class="button-row">
            <button class="number-button" onclick="addNumber('1')">1</button>
            <button class="number-button" onclick="addNumber('2')">2</button>
            <button class="number-button" onclick="addNumber('3')">3</button>
        </div>
        
        <div class="button-row">
            <button class="number-button" onclick="addNumber('4')">4</button>
            <button class="number-button" onclick="addNumber('5')">5</button>
            <button class="number-button" onclick="addNumber('6')">6</button>
        </div>
        
        <div class="button-row">
            <button class="number-button" onclick="addNumber('7')">7</button>
            <button class="number-button" onclick="addNumber('8')">8</button>
            <button class="number-button" onclick="addNumber('9')">9</button>
        </div>
        
        <div class="button-row">
            <button class="number-button red-button" onclick="clearInput()">ОЧИСТИТЬ</button>
            <button class="number-button" onclick="addNumber('0')">0</button>
            <button class="number-button red-button" onclick="deleteLast()">УДАЛИТЬ</button>
        </div>
        
        <button class="action-button green-button" onclick="findUserByBarcode()">[ENTER] НАЙТИ КЛИЕНТА</button>
        <button class="action-button" onclick="showMainScreen()">[ESC] НАЗАД</button>
    </div>

    <!-- ЭКРАН ИНФОРМАЦИИ О КЛИЕНТЕ И НАЧИСЛЕНИЯ -->
    <div class="screen" id="userInfoScreen">
        <div class="status-bar">Кассир: Елена | Начисление бонусов</div>
        
        <div class="user-info">
            <div>Клиент: <span id="userName">-</span></div>
            <div class="balance-display">Баланс: <span id="userBalance">0</span> бонусов</div>
            <div>Штрихкод: <span id="userBarcode">-</span></div>
        </div>

        <!-- КАЛЬКУЛЯТОР СУММЫ ПОКУПКИ -->
        <div class="calculator-display">
            <div>Сумма покупки (руб):</div>
            <input type="text" class="input-field" id="purchaseAmount" placeholder="0" oninput="updateBonusCalculation()">
            
            <div class="bonus-result">
                Бонусов к начислению: <span id="bonusCalculation">0</span>
            </div>
        </div>

        <!-- ПРЯМОЕ НАЧИСЛЕНИЕ БОНУСОВ -->
        <div class="calculator-display">
            <div>Прямое начисление бонусов:</div>
            <input type="text" class="input-field" id="directBonusInput" placeholder="0" value="0">
            
            <div class="button-row">
                <button class="number-button" onclick="addDirectBonus('10')">+10</button>
                <button class="number-button" onclick="addDirectBonus('50')">+50</button>
                <button class="number-button" onclick="addDirectBonus('100')">+100</button>
            </div>
        </div>

        <button class="action-button green-button" onclick="addBonusesToUser()">[F10] НАЧИСЛИТЬ БОНУСЫ</button>
        <button class="action-button" onclick="showMainScreen()">[ESC] НОВЫЙ КЛИЕНТ</button>
    </div>

    <script>
        let currentUser = null;
        let barcodeBuffer = '';
        let barcodeTimeout = null;
        
        // Аутентификация
        function checkLogin() {
            const code = document.getElementById('loginCode').value;
            if (code === '5901') {
                showScreen('mainScreen');
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('loginCode').value = '';
            document.getElementById('loginError').style.display = 'none';
            showScreen('loginScreen');
        }
        
        // Переключение экранов
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Сброс буфера штрихкода при смене экрана
            barcodeBuffer = '';
            clearTimeout(barcodeTimeout);
        }
        
        function showMainScreen() {
            currentUser = null;
            showScreen('mainScreen');
        }
        
        function showManualInput() {
            showScreen('manualInputScreen');
            document.getElementById('barcodeInput').value = '';
            document.getElementById('barcodeInput').focus();
        }
        
        // РАБОТА СО СКАНЕРОМ ШТРИХКОДА
        function startBarcodeScan() {
            showScreen('manualInputScreen');
            document.getElementById('barcodeInput').value = '';
            document.getElementById('barcodeInput').focus();
            document.getElementById('barcodeInput').placeholder = 'Поднесите штрихкод к сканеру...';
        }
        
        function handleBarcodeInput(event) {
            // Если нажат Enter - обрабатываем как завершение ввода
            if (event.key === 'Enter') {
                event.preventDefault();
                findUserByBarcode();
                return false;
            }
            
            // Для сканера - автоматический поиск при вводе 12 цифр
            if (event.key >= '0' && event.key <= '9') {
                barcodeBuffer += event.key;
                clearTimeout(barcodeTimeout);
                
                barcodeTimeout = setTimeout(() => {
                    if (barcodeBuffer.length === 12) {
                        document.getElementById('barcodeInput').value = barcodeBuffer;
                        findUserByBarcode();
                    }
                    barcodeBuffer = '';
                }, 100);
            }
            
            return true;
        }
        
        // Управление вводом штрихкода
        function addNumber(number) {
            const input = document.getElementById('barcodeInput');
            if (input.value.length < 12) {
                input.value += number;
            }
        }
        
        function clearInput() {
            document.getElementById('barcodeInput').value = '';
            barcodeBuffer = '';
        }
        
        function deleteLast() {
            const input = document.getElementById('barcodeInput');
            input.value = input.value.slice(0, -1);
        }
        
        // Поиск пользователя по штрихкоду
        async function findUserByBarcode() {
            const barcode = document.getElementById('barcodeInput').value;
            
            if (barcode.length !== 12) {
                alert('ОШИБКА: Штрихкод должен содержать 12 цифр!');
                return;
            }
            
            // Демо-данные пользователей
            const demoUsers = {
                "123456789012": { username: "Иванов Петр", balance: 150 },
                "987654321098": { username: "Сидорова Мария", balance: 75 },
                "111222333444": { username: "Петров Алексей", balance: 200 },
                "555666777888": { username: "Козлова Анна", balance: 300 }
            };
            
            if (demoUsers[barcode]) {
                currentUser = {
                    barcode: barcode,
                    username: demoUsers[barcode].username,
                    balance: demoUsers[barcode].balance
                };
                
                showUserInfoScreen();
            } else {
                alert('Клиент с таким штрихкодом не найден в системе!');
            }
        }
        
        // Показ информации о пользователе
        function showUserInfoScreen() {
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userBalance').textContent = currentUser.balance;
            document.getElementById('userBarcode').textContent = currentUser.barcode;
            
            document.getElementById('purchaseAmount').value = '';
            document.getElementById('directBonusInput').value = '0';
            updateBonusCalculation();
            
            showScreen('userInfoScreen');
        }
        
        // Калькулятор бонусов
        function updateBonusCalculation() {
            const amount = parseFloat(document.getElementById('purchaseAmount').value) || 0;
            const bonuses = Math.floor(amount / 0.5); // 1 бонус = 0.5 руб
            document.getElementById('bonusCalculation').textContent = bonuses;
        }
        
        // Прямое начисление бонусов
        function addDirectBonus(amount) {
            const input = document.getElementById('directBonusInput');
            const current = parseInt(input.value) || 0;
            input.value = current + parseInt(amount);
        }
        
        // Начисление бонусов
        async function addBonusesToUser() {
            const purchaseAmount = parseFloat(document.getElementById('purchaseAmount').value) || 0;
            const directBonus = parseInt(document.getElementById('directBonusInput').value) || 0;
            
            let bonusesToAdd = directBonus;
            
            if (purchaseAmount > 0) {
                bonusesToAdd += Math.floor(purchaseAmount / 0.5);
            }
            
            if (bonusesToAdd <= 0) {
                alert('ОШИБКА: Введите количество бонусов для начисления!');
                return;
            }
            
            // Обновляем баланс (в реальной системе здесь будет вызов API)
            currentUser.balance += bonusesToAdd;
            
            alert(`Начислено бонусов: ${bonusesToAdd}\nНовый баланс: ${currentUser.balance}`);
            
            // Обновляем отображение
            document.getElementById('userBalance').textContent = currentUser.balance;
            
            // Очищаем поля
            document.getElementById('purchaseAmount').value = '';
            document.getElementById('directBonusInput').value = '0';
            updateBonusCalculation();
        }
        
        // Обработка горячих клавиш
        document.addEventListener('keydown', function(event) {
            // ESC - назад/выход
            if (event.key === 'Escape') {
                if (document.getElementById('mainScreen').classList.contains('active')) {
                    logout();
                } else if (document.getElementById('manualInputScreen').classList.contains('active') || 
                          document.getElementById('userInfoScreen').classList.contains('active')) {
                    showMainScreen();
                }
            }
            
            // F2 - сканирование штрихкода
            if (event.key === 'F2') {
                if (document.getElementById('mainScreen').classList.contains('active')) {
                    startBarcodeScan();
                }
            }
            
            // F3 - ручной ввод
            if (event.key === 'F3') {
                if (document.getElementById('mainScreen').classList.contains('active')) {
                    showManualInput();
                }
            }
            
            // F10 - начислить бонусы
            if (event.key === 'F10') {
                if (document.getElementById('userInfoScreen').classList.contains('active')) {
                    addBonusesToUser();
                }
            }
            
            // Enter в поле ввода штрихкода
            if (event.key === 'Enter') {
                if (document.getElementById('manualInputScreen').classList.contains('active')) {
                    findUserByBarcode();
                }
            }
            
            // Цифры для ручного ввода
            if (event.key >= '0' && event.key <= '9') {
                if (document.getElementById('manualInputScreen').classList.contains('active')) {
                    addNumber(event.key);
                }
            }
        });
        
        // Фокус на поле ввода при открытии экрана ручного ввода
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginCode').focus();
        });
    </script>
</body>
</html>
