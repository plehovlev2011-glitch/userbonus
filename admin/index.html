<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω - –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ü–ï–†–ï–¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #1d2733;
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .screen {
            display: none;
            flex: 1;
            flex-direction: column;
            padding: 10px;
            background: #1d2733;
        }
        
        .active {
            display: flex !important;
        }
        
        .header {
            background: #293a53;
            color: #fff;
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            border: 2px solid #000;
        }
        
        .login-form {
            background: #1d2733;
            padding: 20px;
            border: 2px solid #293a53;
            margin: 20px auto;
            width: 90%;
            max-width: 400px;
        }
        
        .user-list {
            margin: 10px 0;
        }
        
        .user-button {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: #293a53;
            color: #fff;
            border: 2px solid #000;
            cursor: pointer;
            margin: 5px 0;
            text-align: center;
        }
        
        .user-button:active {
            background: #3a4b63;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin: 10px 0;
            border: 2px solid #293a53;
            background: #1d2733;
            color: #fff;
            text-align: center;
        }
        
        .password-display {
            font-size: 24px;
            letter-spacing: 5px;
            text-align: center;
            margin: 10px 0;
            min-height: 40px;
            color: #fff;
        }
        
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin: 10px 0;
        }
        
        .keypad-button {
            padding: 20px;
            font-size: 18px;
            background: #293a53;
            color: #fff;
            border: 2px solid #000;
            cursor: pointer;
        }
        
        .keypad-button:active {
            background: #3a4b63;
        }
        
        .action-button {
            background: #293a53;
            color: #fff;
            border: 2px solid #000;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px 0;
            width: 100%;
        }
        
        .action-button:active {
            background: #3a4b63;
        }
        
        .green-button {
            background: #00aa00;
        }
        
        .red-button {
            background: #aa0000;
        }
        
        .status-bar {
            background: #293a53;
            color: #fff;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #000;
            margin-bottom: 10px;
        }
        
        .main-button {
            background: #293a53;
            color: #fff;
            border: 2px solid #000;
            padding: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px 0;
            text-align: left;
        }
        
        .main-button:active {
            background: #3a4b63;
        }
        
        .input-field {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #293a53;
            background: #1d2733;
            color: #fff;
            margin: 10px 0;
        }
        
        .button-row {
            display: flex;
            gap: 5px;
            margin: 5px 0;
        }
        
        .number-button {
            flex: 1;
            background: #293a53;
            color: #fff;
            border: 2px solid #000;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .number-button:active {
            background: #3a4b63;
        }
        
        .user-info {
            background: #293a53;
            padding: 15px;
            border: 2px solid #000;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .balance-display {
            font-size: 18px;
            color: #fff;
            font-weight: bold;
            margin: 10px 0;
            background: #1d2733;
            padding: 10px;
            border: 1px solid #293a53;
        }
        
        .calculator-display {
            background: #293a53;
            padding: 15px;
            border: 2px solid #000;
            margin: 10px 0;
        }
        
        .bonus-result {
            font-size: 16px;
            color: #fff;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            background: #1d2733;
            padding: 10px;
            border: 1px solid #293a53;
        }
        
        .info-text {
            font-size: 12px;
            color: #fff;
            margin: 5px 0;
        }
        
        .history-list {
            background: #1d2733;
            border: 2px solid #293a53;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #293a53;
            font-size: 11px;
            color: #fff;
            line-height: 1.4;
        }
        
        .history-header {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .history-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 10px;
        }
        
        .developer-section {
            background: #293a53;
            padding: 15px;
            border: 2px solid #000;
            margin: 10px 0;
        }
        
        .special-image {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1d2733;
        }
        
        .special-image img {
            max-width: 100%;
            max-height: 80%;
            object-fit: contain;
        }
        
        .countdown-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1d2733;
            text-align: center;
            padding: 20px;
        }
        
        .countdown-timer {
            font-size: 48px;
            color: #00ff00;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .countdown-text {
            font-size: 24px;
            margin: 20px 0;
        }

        .hidden-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
            height: 0;
        }
    </style>
</head>
<body>
    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã -->
    <input type="text" class="hidden-input" id="keyboardInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö–∫–æ–¥">

    <!-- –≠–ö–†–ê–ù –í–í–û–î–ê –ü–ê–†–û–õ–Ø -->
    <div class="screen active" id="loginScreen">
        <div class="header">–≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</div>
        
        <div class="login-form">
            <div class="info-text">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="currentUser">–ï–ª–µ–Ω–∞</span></div>
            <div class="info-text">–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</div>
            
            <div class="password-display" id="passwordDisplay">*</div>
            <input type="hidden" id="passwordInput">
            
            <div class="keypad">
                <button class="keypad-button" onclick="addPasswordNumber('1')">1</button>
                <button class="keypad-button" onclick="addPasswordNumber('2')">2</button>
                <button class="keypad-button" onclick="addPasswordNumber('3')">3</button>
                <button class="keypad-button" onclick="addPasswordNumber('4')">4</button>
                <button class="keypad-button" onclick="addPasswordNumber('5')">5</button>
                <button class="keypad-button" onclick="addPasswordNumber('6')">6</button>
                <button class="keypad-button" onclick="addPasswordNumber('7')">7</button>
                <button class="keypad-button" onclick="addPasswordNumber('8')">8</button>
                <button class="keypad-button" onclick="addPasswordNumber('9')">9</button>
                <button class="keypad-button red-button" onclick="clearPassword()">–æ—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="keypad-button" onclick="addPasswordNumber('0')">0</button>
                <button class="keypad-button red-button" onclick="deleteLastPassword()">—É–¥–∞–ª–∏—Ç—å</button>
            </div>
            
            <button class="action-button green-button" onclick="checkPassword()">–≤—Ö–æ–¥</button>
            <button class="action-button" onclick="showUserSelect()">–¥—Ä—É–≥–æ–π —é–∑–µ—Ä</button>
            
            <div class="info-text" id="loginError" style="color:#ff4444; display:none;">–Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –í–´–ë–û–†–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
    <div class="screen" id="userSelectScreen">
        <div class="header">–±–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ "–ø–µ—Ä–µ—Ü"</div>
        
        <div class="login-form">
            <div class="info-text">–≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</div>
            
            <div class="user-list">
                <button class="user-button" onclick="selectUser('–ï–ª–µ–Ω–∞')">–ï–ª–µ–Ω–∞</button>
                <button class="user-button" onclick="selectUser('developer')">developer</button>
            </div>
            
            <button class="action-button" onclick="showLoginScreen()">–Ω–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù –ï–õ–ï–ù–´ -->
    <div class="screen" id="mainScreen">
        <div class="status-bar">–∫–∞—Å—Å–∏—Ä: <span id="currentUserName">–ï–ª–µ–Ω–∞</span> | –±–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ "–ø–µ—Ä–µ—Ü"</div>
        
        <button class="main-button" onclick="startBarcodeScan()">
            —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —à—Ç—Ä–∏—Ö–∫–æ–¥
        </button>
        
        <button class="main-button" onclick="showManualInput()">
            —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
        </button>
        
        <button class="main-button" onclick="showScanHistory()">
            –∏—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        </button>
        
        <button class="main-button red-button" onclick="logout()">
            –≤—ã—Ö–æ–¥
        </button>
    </div>

    <!-- –≠–ö–†–ê–ù –†–£–ß–ù–û–ì–û –í–í–û–î–ê –®–¢–†–ò–•–ö–û–î–ê -->
    <div class="screen" id="manualInputScreen">
        <div class="status-bar">–∫–∞—Å—Å–∏—Ä: <span id="manualInputUser">–ïlena</span> | —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞</div>
        
        <div class="password-display" id="barcodeDisplay"></div>
        <input type="hidden" id="barcodeInput">
        
        <div class="info-text">–≤–≤–µ–¥–∏—Ç–µ 12 —Ü–∏—Ñ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ</div>
        
        <div class="keypad">
            <button class="keypad-button" onclick="addBarcodeNumber('1')">1</button>
            <button class="keypad-button" onclick="addBarcodeNumber('2')">2</button>
            <button class="keypad-button" onclick="addBarcodeNumber('3')">3</button>
            <button class="keypad-button" onclick="addBarcodeNumber('4')">4</button>
            <button class="keypad-button" onclick="addBarcodeNumber('5')">5</button>
            <button class="keypad-button" onclick="addBarcodeNumber('6')">6</button>
            <button class="keypad-button" onclick="addBarcodeNumber('7')">7</button>
            <button class="keypad-button" onclick="addBarcodeNumber('8')">8</button>
            <button class="keypad-button" onclick="addBarcodeNumber('9')">9</button>
            <button class="keypad-button red-button" onclick="clearBarcode()">–æ—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="keypad-button" onclick="addBarcodeNumber('0')">0</button>
            <button class="keypad-button red-button" onclick="deleteLastBarcode()">—É–¥–∞–ª–∏—Ç—å</button>
        </div>
        
        <button class="action-button green-button" onclick="findUserByBarcode()">–Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞</button>
        <button class="action-button" onclick="showMainScreen()">–Ω–∞–∑–∞–¥</button>
    </div>

    <!-- –≠–ö–†–ê–ù –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –ö–õ–ò–ï–ù–¢–ï -->
    <div class="screen" id="userInfoScreen">
        <div class="status-bar">–∫–∞—Å—Å–∏—Ä: <span id="userInfoUser">–ï–ª–µ–Ω–∞</span> | –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤</div>
        
        <div class="user-info">
            <div>–∫–ª–∏–µ–Ω—Ç: <span id="userName">-</span></div>
            <div class="balance-display">–±–∞–ª–∞–Ω—Å: <span id="userBalance">0</span> –±–æ–Ω—É—Å–æ–≤</div>
            <div>—à—Ç—Ä–∏—Ö–∫–æ–¥: <span id="userBarcode">-</span></div>
        </div>

        <div class="calculator-display">
            <div>—Å—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏ (—Ä—É–±):</div>
            <div class="password-display" id="purchaseDisplay">0</div>
            <input type="hidden" id="purchaseAmount" value="0">
            
            <div class="keypad">
                <button class="keypad-button" onclick="addPurchaseNumber('1')">1</button>
                <button class="keypad-button" onclick="addPurchaseNumber('2')">2</button>
                <button class="keypad-button" onclick="addPurchaseNumber('3')">3</button>
                <button class="keypad-button" onclick="addPurchaseNumber('4')">4</button>
                <button class="keypad-button" onclick="addPurchaseNumber('5')">5</button>
                <button class="keypad-button" onclick="addPurchaseNumber('6')">6</button>
                <button class="keypad-button" onclick="addPurchaseNumber('7')">7</button>
                <button class="keypad-button" onclick="addPurchaseNumber('8')">8</button>
                <button class="keypad-button" onclick="addPurchaseNumber('9')">9</button>
                <button class="keypad-button red-button" onclick="clearPurchase()">–æ—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="keypad-button" onclick="addPurchaseNumber('0')">0</button>
                <button class="keypad-button" onclick="addPurchaseNumber('.')">.</button>
            </div>
            
            <div class="bonus-result">
                –±–æ–Ω—É—Å–æ–≤ –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é: <span id="bonusCalculation">0</span>
            </div>
        </div>

        <div class="calculator-display">
            <div>–ø—Ä—è–º–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤:</div>
            <div class="password-display" id="directBonusDisplay">0</div>
            <input type="hidden" id="directBonusInput" value="0">
            
            <div class="keypad">
                <button class="keypad-button" onclick="addDirectBonusNumber('1')">1</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('2')">2</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('3')">3</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('4')">4</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('5')">5</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('6')">6</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('7')">7</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('8')">8</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('9')">9</button>
                <button class="keypad-button red-button" onclick="clearDirectBonus()">–æ—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="keypad-button" onclick="addDirectBonusNumber('0')">0</button>
                <button class="keypad-button red-button" onclick="deleteLastDirectBonus()">—É–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>

        <button class="action-button green-button" onclick="addBonusesToUser()">–Ω–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å—ã</button>
        <button class="action-button" onclick="showMainScreen()">–Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</button>
    </div>

    <!-- –≠–ö–†–ê–ù –ò–°–¢–û–†–ò–ò –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø -->
    <div class="screen" id="historyScreen">
        <div class="status-bar">–∏—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
        
        <div class="developer-section">
            <div class="info-text">–ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:</div>
            <div class="history-list" id="scanHistoryList">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <button class="action-button" onclick="showMainScreen()">–Ω–∞–∑–∞–¥</button>
    </div>

    <!-- –≠–ö–†–ê–ù –°–ü–ï–¶–ò–ê–õ–¨–ù–û–ì–û –®–¢–†–ò–•–ö–û–î–ê -->
    <div class="screen" id="specialBarcodeScreen">
        <div class="special-image">
            <img src="1.png" alt="–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" onerror="this.style.display='none'">
            <button class="action-button" onclick="showMainScreen()" style="margin-top: 20px;">—Ö–æ—Ä–æ—à–æ</button>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –û–ë–†–ê–¢–ù–û–ì–û –û–¢–°–ß–ï–¢–ê -->
    <div class="screen" id="countdownScreen">
        <div class="countdown-screen">
            <div class="countdown-text">–±–æ–Ω—É—Å—ã –∫–ª–∏–µ–Ω—Ç—É –Ω–∞—á–∏—Å–ª–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</div>
            <div class="countdown-timer" id="countdownTimer">4</div>
            <button class="action-button red-button" onclick="cancelCountdown()">–æ—Ç–º–µ–Ω–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ</button>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê -->
    <div class="screen" id="developerScreen">
        <div class="status-bar">developer mode | –±–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ "–ø–µ—Ä–µ—Ü"</div>
        
        <div class="developer-section">
            <div class="info-text">–∏—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</div>
            <div class="history-list" id="devHistoryList">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <div class="developer-section">
            <div class="info-text">–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</div>
            <div class="history-list" id="userDatabaseList">
                <!-- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <div class="developer-section">
            <div class="info-text">–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã:</div>
            <button class="main-button" onclick="resetSystem()">—Å–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã</button>
            <button class="main-button" onclick="exportData()">—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
        </div>
        
        <button class="action-button" onclick="logout()">–≤—ã—Ö–æ–¥</button>
    </div>

    <script>
        let currentUser = null;
        let currentUserName = '–ï–ª–µ–Ω–∞';
        let scanHistory = JSON.parse(localStorage.getItem('scanHistory')) || [];
        let countdownInterval = null;
        let lastAddedBonuses = 0;
        
        // –î–µ–º–æ-–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const userDatabase = {
            "123456789012": { username: "–ò–≤–∞–Ω–æ–≤ –ü–µ—Ç—Ä", balance: 150 },
            "987654321098": { username: "–°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", balance: 75 },
            "111222333444": { username: "–ü–µ—Ç—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π", balance: 200 },
            "555666777888": { username: "–ö–æ–∑–ª–æ–≤–∞ –ê–Ω–Ω–∞", balance: 300 },
            "999888777666": { username: "–°–º–∏—Ä–Ω–æ–≤ –î–º–∏—Ç—Ä–∏–π", balance: 125 }
        };
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        function selectUser(user) {
            currentUserName = user;
            document.getElementById('currentUser').textContent = user;
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordDisplay').textContent = '*';
            document.getElementById('loginError').style.display = 'none';
            showScreen('loginScreen');
        }
        
        function showUserSelect() {
            showScreen('userSelectScreen');
        }
        
        function showLoginScreen() {
            showScreen('loginScreen');
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–º
        function addPasswordNumber(num) {
            const input = document.getElementById('passwordInput');
            if (input.value.length < 8) {
                input.value += num;
                document.getElementById('passwordDisplay').textContent = '*'.repeat(input.value.length);
            }
        }
        
        function clearPassword() {
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordDisplay').textContent = '*';
        }
        
        function deleteLastPassword() {
            const input = document.getElementById('passwordInput');
            input.value = input.value.slice(0, -1);
            document.getElementById('passwordDisplay').textContent = '*'.repeat(input.value.length);
        }
        
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            let isValid = false;
            
            if (currentUserName === '–ï–ª–µ–Ω–∞' && password === '5901') {
                isValid = true;
                showMainScreen();
            } else if (currentUserName === 'developer' && password === '42385902') {
                isValid = true;
                showDeveloperScreen();
            }
            
            if (!isValid) {
                document.getElementById('loginError').style.display = 'block';
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (currentUserName) {
                const userElements = document.querySelectorAll('#currentUserName, #manualInputUser, #userInfoUser');
                userElements.forEach(element => {
                    if (element) element.textContent = currentUserName;
                });
            }
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–∞ –Ω—É–∂–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö
            const keyboardInput = document.getElementById('keyboardInput');
            if (screenId === 'manualInputScreen') {
                setTimeout(() => {
                    keyboardInput.focus();
                    keyboardInput.value = '';
                }, 100);
            } else {
                keyboardInput.blur();
            }
        }
        
        function showMainScreen() {
            currentUser = null;
            showScreen('mainScreen');
        }
        
        function logout() {
            currentUser = null;
            currentUserName = '–ï–ª–µ–Ω–∞';
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordDisplay').textContent = '*';
            document.getElementById('loginError').style.display = 'none';
            showScreen('loginScreen');
        }
        
        // –†—É—á–Ω–æ–π –≤–≤–æ–¥ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
        function startBarcodeScan() {
            showScreen('manualInputScreen');
            clearBarcode();
        }
        
        function showManualInput() {
            showScreen('manualInputScreen');
            clearBarcode();
        }
        
        function addBarcodeNumber(num) {
            const input = document.getElementById('barcodeInput');
            if (input.value.length < 12) {
                input.value += num;
                document.getElementById('barcodeDisplay').textContent = input.value;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ 12 —Ü–∏—Ñ—Ä
                if (input.value.length === 12) {
                    setTimeout(() => {
                        findUserByBarcode();
                    }, 100);
                }
            }
        }
        
        function clearBarcode() {
            document.getElementById('barcodeInput').value = '';
            document.getElementById('barcodeDisplay').textContent = '';
        }
        
        function deleteLastBarcode() {
            const input = document.getElementById('barcodeInput');
            input.value = input.value.slice(0, -1);
            document.getElementById('barcodeDisplay').textContent = input.value;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        function setupKeyboardListener() {
            const keyboardInput = document.getElementById('keyboardInput');
            
            keyboardInput.addEventListener('keydown', function(e) {
                // –ï—Å–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
                if (document.getElementById('manualInputScreen').classList.contains('active')) {
                    // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–ª–∞–≤–∏—à–∏
                    if ((e.key >= '0' && e.key <= '9') || 
                        e.key === 'Backspace' || 
                        e.key === 'Delete' || 
                        e.key === 'Enter' || 
                        e.key === 'Escape') {
                        
                        // Enter - –ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            findUserByBarcode();
                            return;
                        }
                        
                        // Escape - –Ω–∞–∑–∞–¥
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            showMainScreen();
                            return;
                        }
                        
                        // Backspace - —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É
                        if (e.key === 'Backspace') {
                            e.preventDefault();
                            deleteLastBarcode();
                            return;
                        }
                        
                        // –¶–∏—Ñ—Ä—ã - –¥–æ–±–∞–≤–ª—è–µ–º –≤–≤–æ–¥
                        if (e.key >= '0' && e.key <= '9') {
                            e.preventDefault();
                            addBarcodeNumber(e.key);
                        }
                    } else {
                        e.preventDefault();
                    }
                }
            });
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —à—Ç—Ä–∏—Ö–∫–æ–¥—É
        function findUserByBarcode() {
            const barcode = document.getElementById('barcodeInput').value;
            
            if (barcode.length !== 12) {
                alert('–æ—à–∏–±–∫–∞: —à—Ç—Ä–∏—Ö–∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 12 —Ü–∏—Ñ—Ä!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
            if (barcode === 'EAAA100000044') {
                showScreen('specialBarcodeScreen');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ç–æ–ª—å–∫–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
            const scanRecord = {
                type: 'scan',
                barcode: barcode,
                clientName: userDatabase[barcode] ? userDatabase[barcode].username : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç',
                timestamp: new Date().toLocaleString('ru-RU'),
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                user: currentUserName,
                oldBalance: userDatabase[barcode] ? userDatabase[barcode].balance : 0,
                addedBonuses: 0,
                newBalance: userDatabase[barcode] ? userDatabase[barcode].balance : 0
            };
            scanHistory.unshift(scanRecord);
            localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
            
            if (userDatabase[barcode]) {
                currentUser = {
                    barcode: barcode,
                    username: userDatabase[barcode].username,
                    balance: userDatabase[barcode].balance
                };
                
                showUserInfoScreen();
            } else {
                alert('–∫–ª–∏–µ–Ω—Ç —Å —Ç–∞–∫–∏–º —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ!');
            }
        }
        
        // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function showUserInfoScreen() {
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userBalance').textContent = currentUser.balance;
            document.getElementById('userBarcode').textContent = currentUser.barcode;
            
            clearPurchase();
            clearDirectBonus();
            updateBonusCalculation();
            
            showScreen('userInfoScreen');
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É–º–º–æ–π –ø–æ–∫—É–ø–∫–∏
        function addPurchaseNumber(num) {
            const input = document.getElementById('purchaseAmount');
            let value = input.value;
            
            if (value === '0') value = '';
            if (num === '.' && value.includes('.')) return;
            
            value += num;
            input.value = value;
            document.getElementById('purchaseDisplay').textContent = value;
            updateBonusCalculation();
        }
        
        function clearPurchase() {
            document.getElementById('purchaseAmount').value = '0';
            document.getElementById('purchaseDisplay').textContent = '0';
            updateBonusCalculation();
        }
        
        function updateBonusCalculation() {
            const amount = parseFloat(document.getElementById('purchaseAmount').value) || 0;
            // 10 –±–æ–Ω—É—Å–æ–≤ = 1 —Ä—É–±–ª—å (1 –±–æ–Ω—É—Å = 0.1 —Ä—É–±–ª—è)
            const bonuses = Math.floor(amount * 10);
            document.getElementById('bonusCalculation').textContent = bonuses;
        }
        
        // –ü—Ä—è–º–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ (—Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞)
        function addDirectBonusNumber(num) {
            const input = document.getElementById('directBonusInput');
            let value = input.value;
            
            if (value === '0') value = '';
            
            value += num;
            input.value = value;
            document.getElementById('directBonusDisplay').textContent = value;
        }
        
        function clearDirectBonus() {
            document.getElementById('directBonusInput').value = '0';
            document.getElementById('directBonusDisplay').textContent = '0';
        }
        
        function deleteLastDirectBonus() {
            const input = document.getElementById('directBonusInput');
            let value = input.value;
            value = value.slice(0, -1);
            if (value === '') value = '0';
            input.value = value;
            document.getElementById('directBonusDisplay').textContent = value;
        }
        
        // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
        function addBonusesToUser() {
            const purchaseAmount = parseFloat(document.getElementById('purchaseAmount').value) || 0;
            const directBonus = parseInt(document.getElementById('directBonusInput').value) || 0;
            
            let bonusesToAdd = directBonus;
            
            if (purchaseAmount > 0) {
                // 10 –±–æ–Ω—É—Å–æ–≤ = 1 —Ä—É–±–ª—å
                bonusesToAdd += Math.floor(purchaseAmount * 10);
            }
            
            if (bonusesToAdd <= 0) {
                alert('–æ—à–∏–±–∫–∞: –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–Ω—É—Å–æ–≤ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è!');
                return;
            }
            
            const oldBalance = currentUser.balance;
            currentUser.balance += bonusesToAdd;
            userDatabase[currentUser.barcode].balance = currentUser.balance;
            lastAddedBonuses = bonusesToAdd;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤)
            const bonusRecord = {
                type: 'bonus_add',
                barcode: currentUser.barcode,
                clientName: currentUser.username,
                timestamp: new Date().toLocaleString('ru-RU'),
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                user: currentUserName,
                oldBalance: oldBalance,
                addedBonuses: bonusesToAdd,
                newBalance: currentUser.balance
            };
            scanHistory.unshift(bonusRecord);
            localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
            startCountdown();
        }
        
        // –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç
        function startCountdown() {
            let seconds = 4;
            showScreen('countdownScreen');
            document.getElementById('countdownTimer').textContent = seconds;
            
            countdownInterval = setInterval(() => {
                seconds--;
                document.getElementById('countdownTimer').textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    showMainScreen();
                    clearPurchase();
                    clearDirectBonus();
                }
            }, 1000);
        }
        
        function cancelCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
            currentUser.balance -= lastAddedBonuses;
            userDatabase[currentUser.barcode].balance = currentUser.balance;
            
            // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤)
            scanHistory = scanHistory.filter(record => 
                !(record.type === 'bonus_add' && record.barcode === currentUser.barcode && record.addedBonuses === lastAddedBonuses)
            );
            localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
            
            document.getElementById('userBalance').textContent = currentUser.balance;
            showUserInfoScreen();
        }
        
        // –ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function showScanHistory() {
            showScreen('historyScreen');
            loadScanHistory();
        }
        
        function loadScanHistory() {
            const historyList = document.getElementById('scanHistoryList');
            historyList.innerHTML = '';
            
            scanHistory.slice(0, 20).forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let content = '';
                if (record.type === 'scan') {
                    content = `
                        <div class="history-header">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - ${record.clientName}</div>
                        <div class="history-details">
                            <div>üìÖ ${record.date}</div>
                            <div>üïí ${record.time}</div>
                            <div>üë§ ${record.user}</div>
                            <div>üìã –®–ö: ${record.barcode}</div>
                            <div>üí∞ –ë–∞–ª–∞–Ω—Å: ${record.oldBalance} –±–æ–Ω—É—Å–æ–≤</div>
                        </div>
                    `;
                } else if (record.type === 'bonus_add') {
                    content = `
                        <div class="history-header">üéÅ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ - ${record.clientName}</div>
                        <div class="history-details">
                            <div>üìÖ ${record.date}</div>
                            <div>üïí ${record.time}</div>
                            <div>üë§ ${record.user}</div>
                            <div>üìã –®–ö: ${record.barcode}</div>
                            <div>üí∞ –ë—ã–ª–æ: ${record.oldBalance} –±–æ–Ω—É—Å–æ–≤</div>
                            <div>‚ûï –ù–∞—á–∏—Å–ª–µ–Ω–æ: ${record.addedBonuses} –±–æ–Ω—É—Å–æ–≤</div>
                            <div>üí∞ –°—Ç–∞–ª–æ: ${record.newBalance} –±–æ–Ω—É—Å–æ–≤</div>
                        </div>
                    `;
                }
                
                item.innerHTML = content;
                historyList.appendChild(item);
            });
        }
        
        // –≠–∫—Ä–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        function showDeveloperScreen() {
            showScreen('developerScreen');
            loadDevHistory();
            loadUserDatabase();
        }
        
        function loadDevHistory() {
            const historyList = document.getElementById('devHistoryList');
            historyList.innerHTML = '';
            
            scanHistory.forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let content = '';
                if (record.type === 'scan') {
                    content = `
                        <div class="history-header">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - ${record.clientName}</div>
                        <div class="history-details">
                            <div>üìÖ ${record.date}</div>
                            <div>üïí ${record.time}</div>
                            <div>üë§ ${record.user}</div>
                            <div>üìã –®–ö: ${record.barcode}</div>
                            <div>üí∞ –ë–∞–ª–∞–Ω—Å: ${record.oldBalance} –±–æ–Ω—É—Å–æ–≤</div>
                        </div>
                    `;
                } else if (record.type === 'bonus_add') {
                    content = `
                        <div class="history-header">üéÅ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ - ${record.clientName}</div>
                        <div class="history-details">
                            <div>üìÖ ${record.date}</div>
                            <div>üïí ${record.time}</div>
                            <div>üë§ ${record.user}</div>
                            <div>üìã –®–ö: ${record.barcode}</div>
                            <div>üí∞ –ë—ã–ª–æ: ${record.oldBalance} –±–æ–Ω—É—Å–æ–≤</div>
                            <div>‚ûï –ù–∞—á–∏—Å–ª–µ–Ω–æ: ${record.addedBonuses} –±–æ–Ω—É—Å–æ–≤</div>
                            <div>üí∞ –°—Ç–∞–ª–æ: ${record.newBalance} –±–æ–Ω—É—Å–æ–≤</div>
                        </div>
                    `;
                }
                
                item.innerHTML = content;
                historyList.appendChild(item);
            });
        }
        
        function loadUserDatabase() {
            const dbList = document.getElementById('userDatabaseList');
            dbList.innerHTML = '';
            
            Object.keys(userDatabase).forEach(barcode => {
                const user = userDatabase[barcode];
                const item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = `${barcode} - ${user.username} - ${user.balance} –±–æ–Ω—É—Å–æ–≤`;
                dbList.appendChild(item);
            });
        }
        
        function resetSystem() {
            if (confirm('—Å–±—Ä–æ—Å–∏—Ç—å —Å–∏—Å—Ç–µ–º—É?')) {
                localStorage.clear();
                location.reload();
            }
        }
        
        function exportData() {
            const data = {
                users: userDatabase,
                history: scanHistory
            };
            alert('–¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª—å');
            console.log('Export Data:', data);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        showScreen('loginScreen');
        setupKeyboardListener();
    </script>
</body>
</html>
